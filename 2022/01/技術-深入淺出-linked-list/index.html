<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <script type="application/ld+json">

{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "[技術] 深入淺出 linked list",
  
  "image": "https://nathan-tw.github.io/images/linked-list/linked.jpg",
  
  "datePublished": "2022-01-21T06:30:15-04:00",
  "dateModified": "2022-01-21T06:30:15-04:00",
  "author": {
    "@type": "Person",
    "name": "nathan",
    
    "image": "https://www.gravatar.com/avatar/cbc7742df63d8fa7a57343453dc6446c"
    
  },
  "mainEntityOfPage": { 
    "@type": "WebPage",
    "@id": "https:\/\/nathan-tw.github.io\/2022\/01\/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list\/" 
  },
  "publisher": {
    "@type": "Organization",
    "name": "star67",
    
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.gravatar.com/avatar/cbc7742df63d8fa7a57343453dc6446c"
    }
    
  },
  "description": "假設我們有一串有順序性的數組，要以何種形式存入記憶體呢？ 我們操作的虛擬記憶體就像是一格格的櫥窗，工程師在配置使用空間時有兩種常見的方式：\n",
  "keywords": []
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.105.0 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="nathan">
<meta name="keywords" content="">
<meta name="description" content="假設我們有一串有順序性的數組，要以何種形式存入記憶體呢？
我們操作的虛擬記憶體就像是一格格的櫥窗，工程師在配置使用空間時有兩種常見的方式：">


<meta property="og:description" content="假設我們有一串有順序性的數組，要以何種形式存入記憶體呢？
我們操作的虛擬記憶體就像是一格格的櫥窗，工程師在配置使用空間時有兩種常見的方式：">
<meta property="og:type" content="article">
<meta property="og:title" content="[技術] 深入淺出 linked list">
<meta name="twitter:title" content="[技術] 深入淺出 linked list">
<meta property="og:url" content="https://nathan-tw.github.io/2022/01/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list/">
<meta property="twitter:url" content="https://nathan-tw.github.io/2022/01/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list/">
<meta property="og:site_name" content="star67">
<meta property="og:description" content="假設我們有一串有順序性的數組，要以何種形式存入記憶體呢？
我們操作的虛擬記憶體就像是一格格的櫥窗，工程師在配置使用空間時有兩種常見的方式：">
<meta name="twitter:description" content="假設我們有一串有順序性的數組，要以何種形式存入記憶體呢？
我們操作的虛擬記憶體就像是一格格的櫥窗，工程師在配置使用空間時有兩種常見的方式：">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2022-01-21T06:30:15">
  
  
    <meta property="article:modified_time" content="2022-01-21T06:30:15">
  
  
  
    
      <meta property="article:section" content="Programming">
    
  
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://www.gravatar.com/avatar/cbc7742df63d8fa7a57343453dc6446c?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/cbc7742df63d8fa7a57343453dc6446c?s=640">





  <meta property="og:image" content="https://nathan-tw.github.io/images/linked-list/linked.jpg">
  <meta property="twitter:image" content="https://nathan-tw.github.io/images/linked-list/linked.jpg">


    <title>[技術] 深入淺出 linked list</title>

    <link rel="icon" href="https://nathan-tw.github.io/favicon.png">
    

    

    <link rel="canonical" href="https://nathan-tw.github.io/2022/01/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://nathan-tw.github.io/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://nathan-tw.github.io/" aria-label="Go to homepage">star67</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://nathan-tw.github.io/#about" aria-label="Open the link: /#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/cbc7742df63d8fa7a57343453dc6446c?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://nathan-tw.github.io/#about" aria-label="Read more about the author">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/cbc7742df63d8fa7a57343453dc6446c?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">nathan</h4>
        
          <h5 class="sidebar-profile-bio">Fake it until make it</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nathan-tw.github.io/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nathan-tw.github.io/categories" title="Categories">
    
      <i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nathan-tw.github.io/tags" title="Tags">
    
      <i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nathan-tw.github.io/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nathan-tw.github.io/#about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/nathan-tw" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="5"
        class="
               hasCoverMetaIn
               ">
        <article class="post" id="top">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      [技術] 深入淺出 linked list
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-01-21T06:30:15-04:00">
        
  January 21, 2022

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://nathan-tw.github.io/categories/programming">Programming</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>假設我們有一串有順序性的數組，要以何種形式存入記憶體呢？
我們操作的虛擬記憶體就像是一格格的櫥窗，工程師在配置使用空間時有兩種常見的方式：</p>
<ol>
<li>配置一段連續的格子 (Array)</li>
<li>配置不連續的格子，並以額外的格子紀錄順序性 (Linked list)
<blockquote>
<p>With a linked list, we can store a list of values that can easily be grown by storing values in different parts of memory</p>
</blockquote>
</li>
</ol>



<div class="figure " >
  
    <img class="fig-img" src="https://nathan-tw.github.io/images/linked-list/memory.png" >
  
  
</div>

<p>因為連續的記憶體是可以隨機存取(random access)的，導致兩種配置方式在資料操作上(e.g., 新增、刪除)的時間及空間成本各有不同。</p>
<h3 id="array-vs-linked-list">Array vs. Linked list</h3>
<p>兩者在記憶體的結構：</p>



<div class="figure " >
  
    <img class="fig-img" src="https://nathan-tw.github.io/images/linked-list/array_data_schema.png"  alt="Data storage scheme of an array">
  
   
    <span class="caption">Data storage scheme of an array</span>
  
</div>




<div class="figure " >
  
    <img class="fig-img" src="https://nathan-tw.github.io/images/linked-list/linkedlist_data_schema.png"  alt="Data storage scheme of a linked list">
  
   
    <span class="caption">Data storage scheme of a linked list</span>
  
</div>

<ul>
<li>
<p>Array：造訪第 i 個元素時因為是隨機存取所以時間複雜度是 O(1)，但因為 Array 內的元素必須是連續的，移除第 i 個元素時必須將其後的元素通通往前移，因此為 O(n)。</p>
</li>
<li>
<p>Linked list：無法利用連續記憶體的隨機存取特性，造訪第 i 個元素時必須先造訪 1 至 i-1，因此時間複雜度為 O(n)，且因為必須以額外的指標做相連，使得存入相同的資料時較 Array 耗費空間。好處是空間配置較為彈性，刪除第 i 個節點時時間複雜度為 O(1)，並且不需要在配置空間時固定長度。</p>
</li>
</ul>
<p>比較兩者使用的空間及特性：</p>
<!-- raw HTML omitted -->
<h3 id="dynamic-array">Dynamic Array</h3>
<p>如果 array 大小固定，python 中的 list 與 go 中的 slice 是如何實現？為何不須在一開始給定 Array 大小，也沒有剛剛提到的固定長度限制？
其實他們都是維護一個<a href="https://en.wikipedia.org/wiki/Dynamic_array">Dynamic Array</a>，簡單來說就是一個包含 Array 的類別或結構體，空間不夠時再抽換 Array。以 go 為例，slice 的結構如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">slice</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">array</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">len</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cap</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>array</code>是一個指向底層 Array 的指標，如果執行<code>append</code>時發現<code>cap</code>等於<code>len</code>則會擴容，也就是更換 pointer。</p>
<!-- raw HTML omitted -->
<h2 id="linked-list-與-pointer">Linked list 與 pointer</h2>
<p>Linux 開發者<strong>Linus Torvalds</strong>在<a href="https://www.youtube.com/watch?v=o8NPllzkFhE">2016 的 TED 演講</a>中提到了 Linux 的哲學，其中他舉了一個刪除 Linked List 節點的例子：</p>
<p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/o8NPllzkFhE" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>以刪除節點為例，考慮到移除第一個節點<code>head</code>需要做例外處理，因為移除第一個節點時沒有辦法以上一個節點出發：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">remove_list_node</span>(List <span style="color:#f92672">*</span>list, Node <span style="color:#f92672">*</span>target)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Node <span style="color:#f92672">*</span>prev <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>    Node <span style="color:#f92672">*</span>current <span style="color:#f92672">=</span> list<span style="color:#f92672">-&gt;</span>head;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Walk the list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span> (current <span style="color:#f92672">!=</span> target) {
</span></span><span style="display:flex;"><span>        prev <span style="color:#f92672">=</span> current;
</span></span><span style="display:flex;"><span>        current <span style="color:#f92672">=</span> current<span style="color:#f92672">-&gt;</span>next;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Remove the target by updating the head or the previous node.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>prev)
</span></span><span style="display:flex;"><span>        list<span style="color:#f92672">-&gt;</span>head <span style="color:#f92672">=</span> target<span style="color:#f92672">-&gt;</span>next;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        prev<span style="color:#f92672">-&gt;</span>next <span style="color:#f92672">=</span> target<span style="color:#f92672">-&gt;</span>next;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Linus 認為有品味的作法是維護一個指向要更新的位址的 indirect pointer，以「檢查某個位址是否需要被更新」的想法，程式碼將大大減少為 4 行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">remove_list_node</span>(List <span style="color:#f92672">*</span>list, Node <span style="color:#f92672">*</span>target)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Node <span style="color:#f92672">**</span>indirect <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>list<span style="color:#f92672">-&gt;</span>head;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>indirect <span style="color:#f92672">!=</span> target)
</span></span><span style="display:flex;"><span>        indirect <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>(<span style="color:#f92672">*</span>indirect)<span style="color:#f92672">-&gt;</span>next;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>indirect <span style="color:#f92672">=</span> target<span style="color:#f92672">-&gt;</span>next;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>假設有<code>A</code>, <code>B</code>, <code>C</code> 三個節點相連，需要維護目前指標及上一個節點的指標，檢查目前指標是否為 Target，如果是則更改上一個指標指向的值：
<!-- raw HTML omitted --></p>
<p>後者的想法則是以一個指標的指標順著指標走，尋找「需要被更新」的位址：
<!-- raw HTML omitted --></p>
<h2 id="linux-kernel-中的-linked-list">Linux kernel 中的 linked list</h2>
<p>我們常見的 Linked list 結構是將資料存放於結構體內，但 Linux kernel 的<code>list_head</code>卻不是這麼做：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// usually
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> list_node {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> data;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">struct</span> list_node <span style="color:#f92672">*</span>next;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// linux/scripts/kconfig/list.h
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> list_head {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">struct</span> list_head <span style="color:#f92672">*</span>next, <span style="color:#f92672">*</span>prev;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>使用方式如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> student
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> name[<span style="color:#ae81ff">16</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> id;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> list_head list;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>如果資料不在 Linked list 的結構體內，不就只能一直循環取不到資料了嗎？假設 Tom 的下個節點是 Jerry，該如何取得 Jerry 的 id？</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> list_node <span style="color:#f92672">*</span>Jerry_list <span style="color:#f92672">=</span> (Tom<span style="color:#f92672">-&gt;</span>list).next;
</span></span></code></pre></div><p>結構體連接示意圖：</p>
<!-- raw HTML omitted -->
<p>Linux kernel 提供了一個很巧妙的 macro <code>container_of</code>，只要知道結構體型別，就能以 member 的位置回推出他所在的 container 位置。
因此剛剛上面的例子可以用這種方式取得 Jerry：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> student
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> name[<span style="color:#ae81ff">16</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> id;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> list_head list;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> list_node <span style="color:#f92672">*</span>Jerry_list <span style="color:#f92672">=</span> (Tom<span style="color:#f92672">-&gt;</span>list).next;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> student <span style="color:#f92672">*</span>Jerry <span style="color:#f92672">=</span> container_of(jerry_list, <span style="color:#66d9ef">struct</span> student, list);
</span></span></code></pre></div><p>那<code>container_of</code>是如何實做的呢？我們先從另一個 macro <code>offsetof</code>開始理解。</p>
<h3 id="offsetof">offsetof</h3>
<p>給定一個結構體 student，要如何算出結構體與其成員的偏移呢？</p>
<!-- raw HTML omitted -->
<p>C89/C99 提供 offsetof 巨集，傳統上<code>offsetof</code>是這樣實做的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#define offsetof(TYPE, MEMBER) ((size_t) &amp;((TYPE *)0)-&gt;MEMBER)
</span></span></span></code></pre></div><p>將數值 0 強制轉型成 TYPE 指標型別，0 會被當作該 TYPE 的起始地址，因為起始位址等於 0
，所以 MEMBER 的位址也就等於 MEMBER 與起始位址 0 的偏移(offset)。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>offsetof(<span style="color:#66d9ef">struct</span> student, id)); <span style="color:#75715e">//16
</span></span></span></code></pre></div><h3 id="container_of">container_of</h3>
<p>container_of 的定義較為複雜：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#define container_of(ptr, type, member) ({\
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        const typeof( ((type *)0)-&gt;member ) *__mptr = (ptr);\
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">              (type *)( (char *)__mptr - offsetof(type,member));})
</span></span></span></code></pre></div><p>可以拆解為兩部份，第一部份為：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">typeof</span>( ((type <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0</span>)<span style="color:#f92672">-&gt;</span>member ) <span style="color:#f92672">*</span>__mptr <span style="color:#f92672">=</span> (ptr);
</span></span></code></pre></div><p>利用 ptr 得到該 member 型態同值的__mptr，
以 member 是 list 為例就是 x+20，
(但目前不知道 offset 為 20)。</p>
<p>既然有了__mptr 就輕鬆了，第二部份可以利用<code>offsetof</code>計算所在的結構體位置：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>(type <span style="color:#f92672">*</span>)( (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)__mptr <span style="color:#f92672">-</span> offsetof(type,member));
</span></span></code></pre></div><p>回頭看看 Tom 如何取得 Jerry，利用<code>struct student</code>中的成員 <code>list</code>以<code>offsetof</code>取得 Jerry 的指標。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> student <span style="color:#f92672">*</span>Jerry <span style="color:#f92672">=</span> container_of(Jerry_list, <span style="color:#66d9ef">struct</span> student, list);
</span></span></code></pre></div><p>一切便大功告成！這樣的方式使許多非連續記憶體的操作更廣泛使用，例如<a href="https://github.com/torvalds/linux/blob/master/net/netlabel/netlabel_addrlist.h">network address table</a>及檔案系統的<a href="https://github.com/torvalds/linux/blob/master/fs/mount.h">namespace</a>等等。</p>
<h2 id="小結與後記">小結與後記</h2>
<ul>
<li>
<p>Linked list 使用時機：</p>
<ul>
<li>無法預期資料數量或頻繁變動資料數量時。</li>
<li>需要頻繁地新增/刪除資料時。</li>
<li>不需要快速查詢資料。</li>
</ul>
</li>
<li>
<p>程式可以用不同角度思考</p>
</li>
</ul>
<blockquote>
<p>人們對「品味」的概念各有見解，談到程式碼是否有品味，開發者又是如何執行判斷？Linux 之父 Linus Torvalds 曾提到一個案例來說明，他認為，重點並不在於邊界情況（Edge case），而是能以不同的角度看問題、直覺地選擇出正確的方法</p>
</blockquote>
<p>在<a href="https://www.ithome.com.tw/voice/139264">良葛格</a>的部落格中也談到了，品味並非完全主觀的，其中涉及文化及時空，他以品酒為例，品酒的禮儀、使用的杯器、產地、品牌、文化等等，這些都能是品味的客觀因素。</p>
<blockquote>
<p>粗製濫造的程式碼固然是可以解決問題，然而，這可能也代表了一件事：手邊可以解決問題的方式，少得可憐。</p>
</blockquote>
<h2 id="reference">Reference</h2>
<ul>
<li>linked list vs. array: <a href="http://alrightchiu.github.io/SecondRound/linked-list-introjian-jie.html#comp">http://alrightchiu.github.io/SecondRound/linked-list-introjian-jie.html#comp</a></li>
<li>linked list vs. array: <a href="https://www.geeksforgeeks.org/linked-list-vs-array/">https://www.geeksforgeeks.org/linked-list-vs-array/</a></li>
<li>array and linked List: <a href="https://pjchender.dev/dsa/dsa-array-linked-list/">https://pjchender.dev/dsa/dsa-array-linked-list/</a></li>
<li>list_head 結構: <a href="http://adrianhuang.blogspot.com/2007/10/linux-kernel-listhead.html">http://adrianhuang.blogspot.com/2007/10/linux-kernel-listhead.html</a></li>
<li>良葛格 blog: <a href="https://www.ithome.com.tw/voice/139264">https://www.ithome.com.tw/voice/139264</a></li>
</ul>
              


            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
            
            
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://nathan-tw.github.io/2022/11/leetcode-300.-longest-increasing-subsequence/" data-tooltip="[Leetcode] 300. Longest Increasing Subsequence" aria-label="NEXT: [Leetcode] 300. Longest Increasing Subsequence">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://nathan-tw.github.io/2021/08/%E7%94%9F%E6%B4%BB-%E5%A4%8F%E5%A4%9C%E5%A4%A2%E8%BF%B4/" data-tooltip="[生活] 夏夜夢迴" aria-label="PREVIOUS: [生活] 夏夜夢迴">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://nathan-tw.github.io/2022/01/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list/" title="Share on Facebook" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://nathan-tw.github.io/2022/01/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https://nathan-tw.github.io/2022/01/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#disqus_thread" aria-label="Leave a comment">
        <i class="far fa-comment"></i>
      </a>
    </li>
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


            
  
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
    <script type="text/javascript">
      var disqus_config = function() {
        this.page.url = 'https:\/\/nathan-tw.github.io\/2022\/01\/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list\/';
        
          this.page.identifier = '\/2022\/01\/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list\/'
        
      };
      (function() {
        
        
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
          document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
          return;
        }
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        var disqus_shortname = 'star67';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  


          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 nathan. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://nathan-tw.github.io/2022/11/leetcode-300.-longest-increasing-subsequence/" data-tooltip="[Leetcode] 300. Longest Increasing Subsequence" aria-label="NEXT: [Leetcode] 300. Longest Increasing Subsequence">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://nathan-tw.github.io/2021/08/%E7%94%9F%E6%B4%BB-%E5%A4%8F%E5%A4%9C%E5%A4%A2%E8%BF%B4/" data-tooltip="[生活] 夏夜夢迴" aria-label="PREVIOUS: [生活] 夏夜夢迴">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://nathan-tw.github.io/2022/01/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list/" title="Share on Facebook" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://nathan-tw.github.io/2022/01/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https://nathan-tw.github.io/2022/01/%E6%8A%80%E8%A1%93-%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-linked-list/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#disqus_thread" aria-label="Leave a comment">
        <i class="far fa-comment"></i>
      </a>
    </li>
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


      </div>
      
<div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <i id="btn-close-shareoptions" class="fa fa-times"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fnathan-tw.github.io%2F2022%2F01%2F%25E6%258A%2580%25E8%25A1%2593-%25E6%25B7%25B1%25E5%2585%25A5%25E6%25B7%25BA%25E5%2587%25BA-linked-list%2F" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fnathan-tw.github.io%2F2022%2F01%2F%25E6%258A%2580%25E8%25A1%2593-%25E6%25B7%25B1%25E5%2585%25A5%25E6%25B7%25BA%25E5%2587%25BA-linked-list%2F" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnathan-tw.github.io%2F2022%2F01%2F%25E6%258A%2580%25E8%25A1%2593-%25E6%25B7%25B1%25E5%2585%25A5%25E6%25B7%25BA%25E5%2587%25BA-linked-list%2F" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i><span>Share on Linkedin</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>


    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/cbc7742df63d8fa7a57343453dc6446c?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">nathan</h4>
    
      <div id="about-card-bio">Fake it until make it</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Software Engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        Taiwan
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://nathan-tw.github.io/images/cover.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://nathan-tw.github.io/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>


  
    <script async crossorigin="anonymous" defer integrity="sha512-gE8KAQyFIzV1C9+GZ8TKJHZS2s+n7EjNtC+IMRn1l5+WYJTHOODUM6JSjZhFhqXmc7bG8Av6XXpckA4tYhflnw==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/apache.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-EWROca+bote+7Oaaar1F6y74iZj1r1F9rm/ly7o+/FwJopbBaWtsFDmaKoZDd3QiGU2pGacBirHJNivmGLYrow==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/go.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-GDVzAn0wpx1yVtQsRWmFc6PhJiLBPdUic+h4GWgljBh904O3JU10fk9EKNpVyIoPqkFn54rgL2QBG4BmUTMpiQ==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/http.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-UgZlma8NzkrDb/NWgmLIcTrH7i/CSnLLDRFqCSNF5NGPpjKmzyM25qcoXGOup8+cDakKyaiTDd7N4dyH4YT+IA==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/less.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-lot9koe73sfXIrUvIPM/UEhuMciN56RPyBdOyZgfO53P2lkWyyXN7J+njcxIIBRV+nVDQeiWtiXg+bLAJZDTfg==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/nginx.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-Zd3e7XxHP00TD0Imr0PIfeM0fl0v95kMWuhyAS3Wn1UTSXTkz0OhtRgBAr4JlmADRgiXr4x7lpeUdqaGN8xIog==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/puppet.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-qtqDO052iXMSP+5d/aE/jMtL9vIIGvONgTJziC2K/ZIB1yEGa55WVxGE9/08rSQ62EoDifS9SWVGZ7ihSLhzMA==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/scss.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-1NmkjnEDnwwwcu28KoQF8vs3oaPFokQHbmbtwGhFfeDsQZtVFI8zW2aE9O8yMYdpdyKV/5blE4pSWw4Z/Sv97w==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/stylus.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-B2wSfruPjr8EJL6IIzQr1eAuDwrsfIfccNf/LCEdxELCgC/S/ZMt/Uvk80aD79m7IqOqW+Sw8nbkvha20yZpzg==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/swift.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-28oDiQZGKUVN6wQ7PSLPNipOcmkCALXKwOi7bnkyFf8QiMZQxG9EQoy/iiNx6Zxj2cG2SbVa4dXKigQhu7GiFw==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/yaml.min.js"></script>
  


<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      CommonHTML: { linebreaks: { automatic: true } },
      tex2jax: { inlineMath: [ ['$', '$'], ['\\(','\\)'] ], displayMath: [ ['$$','$$'], ['\\[', '\\]'] ], processEscapes: false },
      messageStyle: 'none'
    });
  </script>



    
  </body>
</html>

